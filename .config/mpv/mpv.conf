# ===============================================
# MPV CONFIG: RTX 3060 + Intel UHD 630 Desktop
# Optimized for 4K60 @ 1.75-2x playback speed
# ===============================================

# === CRITICAL: Hardware Decoding Settings ===
# Use NVDEC (RTX 3060) with copy-back for speed changes
hwdec=nvdec-copy
# Fallback chain if NVDEC fails
hwdec-codecs=all

# Remove the Intel GPU forcing - let MPV choose!
# DELETE THIS LINE: vaapi-device=/dev/dri/card0

# === Video Output Configuration ===
vo=gpu-next                     # Better than 'gpu' for modern GPUs
gpu-api=vulkan                  # Better performance than OpenGL
gpu-context=x11vk              # X11 with Vulkan
profile=gpu-hq                 # Enable high quality profile
scale=ewa_lanczossharp        # High quality upscaling
cscale=ewa_lanczossharp       # High quality chroma scaling
dscale=mitchell               # Smoother downscaling for 4Kâ†’1080p

# === Performance Optimizations for High-Speed Playback ===
video-sync=display-resample    # Critical for smooth playback at non-native speeds
interpolation=yes              # Smooth motion for speed changes
tscale=oversample             # Better temporal scaling for speed changes

# GPU shader cache (reduces stuttering on repeat views)
gpu-shader-cache-dir=~/.cache/mpv-shaders

# Pre-decode more frames for smoother high-speed playback
vd-lavc-threads=12            # Use all your CPU threads (i7-8700 has 12)
hwdec-extra-frames=24         # Buffer more frames for 2x speed

# === Cache Settings (Optimized for 4K) ===
cache=yes
cache-pause=no
cache-pause-wait=1
# More reasonable cache sizes
demuxer-max-bytes=1500M      # 1.5GB for 4K content
demuxer-max-back-bytes=500M  # 500MB backward cache
demuxer-readahead-secs=20    # Read ahead 20 seconds

# === Audio Settings ===
ao=pulse
audio-pitch-correction=yes    # Maintain pitch at high speeds
audio-spdif=ac3,eac3,dts-hd,truehd
pulse-latency-hacks=yes      # Uncomment this - helps with speed changes
af=scaletempo2               # Better audio at non-1x speeds

# === Subtitle Settings ===
slang=en,eng
sub-auto=fuzzy
sub-font='SF-Mono-Semibold'
sub-font-size=40
sub-border-size=1
sub-color=1.0/1.0/0.0/0.7
sub-border-style=opaque-box
sub-border-color='#000000'
sub-back-color='#000000'
sub-scale-with-window=yes
sub-bold=no

# === Window and Interface ===
keep-open=yes
autofit=70%x70%
geometry=50:40
stop-screensaver=yes
cursor-autohide=yes
cursor-autohide-timeout=2
osd-font-size=25
term-osd-bar=yes

# === Playback Settings ===
# Don't set speed here - control it per video!
# speed=1.75  # REMOVE THIS - set speed with [ ] keys when needed
save-position-on-quit=yes
load-stats-overlay=yes

# === Quality Settings ===
deband=yes                    # Reduce banding in gradients
deband-iterations=4
deband-threshold=35
deband-range=16
deband-grain=5

# === Frame Dropping (Emergency only) ===
# Only drop frames if absolutely necessary
framedrop=decoder             # Drop at decoder stage if needed
video-latency-hacks=yes       # Help with high-speed playback

# === Logging (disable after testing) ===
# log-file="/home/ben/.config/mpv/mpv.log"  # Comment out after testing
msg-level=all=warn,vd=v,vo=v  # Verbose video decode/output for debugging
